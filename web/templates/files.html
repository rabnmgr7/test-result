<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Uploaded Files</title>
</head>
<body>
    <h2>List of Uploaded Files</h2>
    <ul id="fileList"></ul>

    <script>
        function fetchFilesList() {
            fetch('/files')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch file list');
                }
                return response.text(); // Parse response as text (HTML)
            })
            .then(html => {
                var fileList = document.getElementById('fileList');
                fileList.innerHTML = html; // Update HTML content directly
            })
            .catch(error => {
                console.error('Error fetching file list:', error);
                alert('Failed to fetch file list. Please try again.');
            });
        }

        // Initial fetch of file list when page loads
        fetchFilesList();

        function downloadFile(fileId) {
            fetch(`/download/${fileId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to download file');
                }
                return response.blob(); // Get file data as Blob
            })
            .then(blob => {
                var url = window.URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = ''; // You can set a custom download filename here
                a.click();
                window.URL.revokeObjectURL(url);
            })
            .catch(error => {
                console.error('Error downloading file:', error);
                alert('Failed to download file. Please try again.');
            });
        }
    </script>
</body>
</html>
